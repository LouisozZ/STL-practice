# 异常

C++ 的异常是对程序运行过程中发生的异常的一种响应。这种响应的动作是将控制权从程序的一部分转移到另一部分。

异常的结构：

```c++
Typename function(...)
{
    ...
    try{
        ...//可能抛出异常的代码
        {
            ...
            throw 特征标1;
            ...
        }
        abnormal_function();
    }
    catch (特征标1)
    {
        ...//异常处理代码
    }
    catch (特征标2)
    {
        ...//异常处理代码
    }
    ...
}

Typename abnormal_function(...)
{
    ...
    throw 特征标2
    ...
}
```

说明：

1. 异常程序由三部分组成
    - try块
    - catch块
    - 可能抛出异常（throw）的代码块
2. **try 块**的功能是将可能抛出异常的代码块包含起来，如果在 try 块中执行了 throw 语句，则这个抛出的异常会被 try 块后面的 catch 块捕获到。如果在 try 块之外抛出异常（调用了） throw ，是没有对应的 catch 块来捕获的,这个时候默认情况下程序会异常终止。
3. **catch块**的功能是捕获异常，与 try 块匹配使用。一个 try 块后面可以跟着多个 catch 块，每个 catch 块都是由关键字 catch 开头，后面紧跟着一对小括号，小括号中是特征标，会匹配对应的 throw。 catch 块中的就是异常处理程序。如果 catch 的特征标中是三个点，那么表示的是可以接收任何的异常抛出。
4. **异常的抛出**是通过关键字 throw 来完成的。是否在程序执行中抛出异常，是由程序员来决定的，即是否写 throw 语句。“可能抛出异常的代码块” 既可以指包含 throw 语句的一段程序，也可以指包含 throw 语句的一个函数。throw 后面跟着的是特征标，用于匹配 catch 关键字后面小括号中的特征标。**（这里的特征标是按值传递的，如果是要传递一个对象，那么直接通过对应的构造函数创建一个匿名对象是可以的）**
5. 如果在一个 catch 块中再次调用 throw ，则是对刚捕获到的异常再次抛出，此时的特征标就是 catch 的特征标。

现在如果有这样的异常结构：

```c++
function()
{
    try{
        throw 特征标1
        ...
        throw 特征标2
    }
    catch (特征标1){
        throw；
    }
    catch (特征标3){

    }
}

int main()
{
    try{
        function();
    }
    catch (特征标1){

    }
    catch (特征标2){

    }
}
```

对于上述代码中，如果在函数 function 中抛出了异常1，那么控制权会转移到 function 内部的 catch1 中，并且由于在 function-catch1 中又再次抛出同样的异常，这时候就会将控制权转移到 main-catch1 里面；如果函数 function 中抛出了异常 2，由于 function 中没有处理异常 2 的 catch ，所以这个时候控制权会转移到 main-catch 2中。**综上所述，当一个异常被抛出之后，控制权会转移到第一个于其特征标匹配的 catch 块中，如果沿着函数栈一直往上都没有找到匹配的 catch 块，那么程序就会异常终止。**

[返回主目录](../README.md)